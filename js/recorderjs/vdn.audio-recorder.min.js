!function(n){var t=vdnWorkerPath;n.Recorder=function(n,e){var o=e||{},r=o.bufferLen||4096;this.context=n.context;var a=n.context.createAnalyser();n.connect(a),a.fftSize=2048;let c=null,l=null,i=null,s=null,u=!1,f=0,d=0,h=null,p="",v=17;this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(r,2,2):this.node=this.context.createJavaScriptNode(r,2,2);var m=new Worker(o.workerPath||t);m.postMessage({command:"vdnInit",config:{sampleRate:this.context.sampleRate}});var g,x=!1;this.node.onaudioprocess=function(n){if(!x)return;"textarea"==p.toLowerCase()&&(v=40);var t=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(t);var e=0;let o=t.length;for(let n=0;n<o;n++)e+=t[n];var r,g;g=e,l=null==(r=l)?g:(4*r+g)/5,l=parseInt(l),null==i?i=l:l<i&&(i=l),null==s?s=l:l>s&&(s=l)>2*i&&(u=!0),c+10<l&&(d=0,f+=1),c-10>l&&(f=0,d+=1),c=l,d>v&&u&&function(){try{null!=h&&-1!=(h.className||"").indexOf("listening")&&h.click()}catch(n){console.log("VDN Error: Unable to reset Mic button.")}}(),m.postMessage({command:"vdnRecord",buffer:[n.inputBuffer.getChannelData(0),n.inputBuffer.getChannelData(1)]})},this.configure=function(n){for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t])},this.record=function(n=null,t=""){x=!0,h=n,p=t},this.stop=function(){x=!1,c=null,f=0,d=0,l=null,i=null,s=null,u=!1},this.clear=function(){vdnMicButtonInCtx=null,p=null,m.postMessage({command:"vdnClear"})},this.getBuffers=function(n){g=n||o.callback,m.postMessage({command:"vdnGetBuffers"})},this.exportWAV=function(n,t){if(g=n||o.callback,t=t||o.type||"audio/wav",!g)throw new Error("Callback not set");m.postMessage({command:"vdnExportWAV",type:t})},this.exportMonoWAV=function(n,t){if(g=n||o.callback,t=t||o.type||"audio/wav",!g)throw new Error("Callback not set");m.postMessage({command:"vdnExportMonoWAV",type:t})},this.convertBlobToBase64=function(n){return new Promise(function(t,e){if(!(void 0!==n&&n&&n instanceof Blob))return void e(null);let o=new FileReader;o.readAsDataURL(n),o.onload=function(){let n=o.result;void 0!==n&&n&&-1!==n.indexOf(",")?t(n.split(",")[1]):e(null)},o.onerror=function(n){o.abort()},o.onabort=function(){e(null)}})},m.onmessage=function(n){var t=n.data;g(t)},a.connect(this.node),this.node.connect(this.context.destination)}}(window);
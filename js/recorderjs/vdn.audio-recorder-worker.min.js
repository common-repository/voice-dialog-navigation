var vdnSampleRate,vdnRecLength=0,vdnRecBuffersL=[],vdnRecBuffersR=[];function vdnInit(e){vdnSampleRate=e.sampleRate}function vdnRecord(e){vdnRecBuffersL.push(e[0]),vdnRecBuffersR.push(e[1]),vdnRecLength+=e[0].length}function vdnExportWAV(e){let n=vdnEncodeWAV(vdnInterleave(vdnMergeBuffers(vdnRecBuffersL,vdnRecLength),vdnMergeBuffers(vdnRecBuffersR,vdnRecLength))),t=new Blob([n],{type:e});this.postMessage(t)}function vdnExportMonoWAV(e){let n=vdnEncodeWAV(vdnMergeBuffers(vdnRecBuffersL,vdnRecLength),!0),t=new Blob([n],{type:e});this.postMessage(t)}function vdnGetBuffers(){let e=[];e.push(vdnMergeBuffers(vdnRecBuffersL,vdnRecLength)),e.push(vdnMergeBuffers(vdnRecBuffersR,vdnRecLength)),this.postMessage(e)}function vdnClear(){vdnRecLength=0,vdnRecBuffersL=[],vdnRecBuffersR=[]}function vdnMergeBuffers(e,n){let t=new Float32Array(n),r=0,d=e.length;for(var v=0;v<d;v++)t.set(e[v],r),r+=e[v].length;return t}function vdnInterleave(e,n){for(var t=e.length+n.length,r=new Float32Array(t),d=0,v=0;d<t;)r[d++]=e[v],r[d++]=n[v],v++;return r}function vdnFloatTo16BitPCM(e,n,t){let r=t.length;for(let d=0;d<r;d++,n+=2){let r=Math.max(-1,Math.min(1,t[d]));e.setInt16(n,r<0?32768*r:32767*r,!0)}}function vdnWriteString(e,n,t){let r=t.length;for(var d=0;d<r;d++)e.setUint8(n+d,t.charCodeAt(d))}function vdnEncodeWAV(e,n){let t=new ArrayBuffer(44+2*e.length),r=new DataView(t);return vdnWriteString(r,0,"RIFF"),r.setUint32(4,32+2*e.length,!0),vdnWriteString(r,8,"WAVE"),vdnWriteString(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,n?1:2,!0),r.setUint32(24,vdnSampleRate,!0),r.setUint32(28,4*vdnSampleRate,!0),r.setUint16(32,4,!0),r.setUint16(34,16,!0),vdnWriteString(r,36,"data"),r.setUint32(40,2*e.length,!0),vdnFloatTo16BitPCM(r,44,e),r}this.onmessage=function(e){switch(e.data.command){case"vdnInit":vdnInit(e.data.config);break;case"vdnRecord":vdnRecord(e.data.buffer);break;case"vdnExportWAV":vdnExportWAV(e.data.type);break;case"vdnExportMonoWAV":vdnExportMonoWAV(e.data.type);break;case"vdnGetBuffers":vdnGetBuffers();break;case"vdnClear":vdnClear()}};
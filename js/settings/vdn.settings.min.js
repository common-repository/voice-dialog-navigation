var vdnSynthErrorCount=0;function toggleVdnDialogType(e="generic"){try{let t="vd-navigation-hide",n=document.querySelector("div[data-vdn-notice]");"generic"==e?(document.getElementById("vdNavigationDialogConfigFormSection").classList.remove(t),document.getElementById("vdNavigationCustomEndpointRow").classList.add(t),n&&null!==n&&n.classList.remove(t)):(document.getElementById("vdNavigationDialogConfigFormSection").classList.add(t),document.getElementById("vdNavigationCustomEndpointRow").classList.remove(t),n&&null!==n&&n.classList.add(t))}catch(e){}}function toggleIntentAccessiblity(e){try{if(e&&null!==e){let t=["data-response-name","data-url-name","data-save-button-name"],n=!(!e.checked||!0!==e.checked),i=t.length;for(let o=0;o<i;o++){let i=t[o],l=e.getAttribute(i);if(!l||null===l)continue;let a=document.querySelector(l);a&&null!==a&&(a.type&&"submit"===a.type?!0===n&&a.removeAttribute("disabled"):!0===n?a.removeAttribute("readonly"):a.setAttribute("readonly",n))}}}catch(e){}}function vdnToggleGaTrackingIdField(e=null){try{if(void 0===e||!e)return!1;let t=document.querySelector("div[id=vdnGaTrackingIdWrapper]");if(t){t.classList.toggle("vdn-hide-element")}}catch(e){}}function vdnResetTimeoutDefaultValue(e,t){void 0!==e&&(0==e.value.length?e.value="8":parseInt(e.value)>20?e.value="20":parseInt(e.value)<8&&(e.value="8"))}function vdnValidateTimeoutValue(e,t){void 0!==e&&2==e.value.length&&parseInt(e.value)>20&&t.preventDefault()}function vdnVoiceChange(e){let t=e.value,n=e.getAttribute("data-old-value"),i=e.getAttribute("data-do-synthesize");t&&n&&n!==t?e.setAttribute("data-do-synthesize",!0):i&&"true"===i&&e.setAttribute("data-do-synthesize",!1)}function vdnGaIdChange(e){if(e){let n=e.value,i=e.getAttribute("data-error");function t(t=null){if(!t||"show"!=t&&"hide"!=t)return!1;let n=document.getElementById("vdnGaIdError"),i=document.getElementById("vdNavigationBasicConfigSettingsSave"),o="",l="",a="",d="";"show"==t?(o="2px solid #FF0000",l="#FF0000",a="1",d="block",i&&i.setAttribute("disabled","disabled")):(o="",l="#000000",a="0",d="none",i&&i.removeAttribute("disabled")),e.style.outline=o,e.style.color=l,e.setAttribute("data-error",a),n&&(n.style.display=d)}if(n){let e=n.toLowerCase();(1==e.length&&"u"==e||2==e.length&&"ua"==e||e.length>2&&"ua-"==e.substring(0,3))&&"1"==i&&t("hide"),(1==e.length&&"u"!=e||2==e.length&&"ua"!=e||e.length>2&&"ua-"!=e.substring(0,3))&&"0"==i&&t("show")}else"1"==i&&t("hide")}}function vdnGetSynthesizableIntents(e){let t=e?"data-intents-with-audios":"data-intents-for-audio-regeneration",n=document.getElementById("vdNavigationDialogConfigFormSection"),i=n?n.getAttribute(t):null;return i?JSON.parse(i):null}function vdnSynthesizeRecursively(e,t,n,i){let o=void 0!==e&&e?e:null,l=void 0!==t&&t?t:null,a=void 0!==n&&n?n:null;if(!(o&&o.length>0)||vdnSynthErrorCount>0){let e=vdnSynthErrorCount;return vdnSynthErrorCount=0,vdnSynthesizeProcPopup("hide",!0),void("function"==typeof i?i(e>0):window.location.reload())}let d=o.shift(),r=document.querySelector("form[data-intent-option-key="+d+"]"),u=r?r.elements:null;if(!u)return;let s=u[d+"[response]"],c=s?s.getAttribute("data-old-value"):null;c&&(vdnUpdateSynthCounter(a,parseInt(a)-parseInt(o.length)),vdnSynthesize(c,d,null,l).then(function(){vdnSynthesizeRecursively(o,l,a,i)}).catch(function(e){let t=void 0!==e&&e?e:{},n=("code"in t&&t.code,"error"in t?t.error:null);n&&alert(n),vdnSynthErrorCount+=1,vdnSynthesizeRecursively(o,l,a,i)}))}function vdnSynthesize(e,t,n,i){"undefined"==typeof isLanguageChange||!isLanguageChange||isLanguageChange;let o=void 0!==e&&e?e:null,l=void 0!==t&&t?t:null,a="Unable to synthesize the dialog. ";return new Promise(function(e,t){let d=new FormData;if(!o||!l)return void t({code:"VDN_ERROR_5",error:a+"Required parameters are missing."});d.append("dialog_text",o),d.append("dialog_op_name",l),void 0!==i&&i&&d.append("voice_for_synth",i),d.append("action","vdn_synthesize"),d.append("_ajax_nonce",vdnAjaxObj.synthesize_nonce);let r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==this.readyState)if(200===this.status){let i=JSON.parse(this.response),o=void 0!==i&&"success"in i?i.success:null,d=void 0!==i&&"data"in i?i.data:null;if(o){if(d&&void 0!==n&&n){let e="voice"in d?d.voice:null,t="path"in d?d.path:null,i=n.elements;if(e&&t&&void 0!==i&&i){let n=i[l+"[intent_audio_response][voice]"],o=i[l+"[intent_audio_response][path]"];n.value=e,o.value=t}}e()}else{"code"in d&&d.code;let e="error"in d?d.error:null;t({code:"VDN_ERROR_6",error:e?a+e:a})}}else t({code:"VDN_ERROR_7",error:a+"Technically improper request to the server."})},r.open("POST",vdnAjaxObj.ajax_url,!0),r.send(d)})}function vdnBasicFormSubmitHandler(e,t){if(void 0!==e&&e){let n=!1,i=e.querySelector("select[data-synth-decider=voice]"),o=i?i.getAttribute("data-do-synthesize"):null;if(n=!(!o||"true"!==o)){t.preventDefault();let n=i.value.trim(),o=i.getAttribute("data-old-value"),l=vdnGetSynthesizableIntents(!0);l&&l.length>0&&(vdnSynthesizeProcPopup("show",!0),vdnSynthesizeRecursively(l,n,l.length,function(t){void 0!==t&&!0===t?(i.value=o,window.location.reload()):e.submit()}))}}}function vdnDialogFormSubmitHandler(e,t){if(e){let n=!1,i=e.elements,o=e.getAttribute("data-intent-option-key"),l=i[o+"[response]"],a=l?l.getAttribute("data-old-value").trim():null,d=l?l.value.trim():null,r=i[o+"[enabled]"],u=(r&&r.getAttribute("data-old-value").trim(),r?r.value.trim():null);d&&a!==d&&(n=!0);let s=i[o+"[intent_audio_response][voice]"],c=s?s.value:null,v=e.getAttribute("data-current-voice");!1===n&&u&&"enabled"==u&&c&&v&&c!==v&&(n=!0),n&&d&&(t.preventDefault(),vdnSynthesizeProcPopup("show",!1),vdnSynthesize(d,o,e,null).then(function(t){vdnSynthesizeProcPopup("hide",!1),e.submit()}).catch(function(e){let t=void 0!==e&&e?e:{},n=("code"in t&&t.code,"error"in t?t.error:null);vdnSynthesizeProcPopup("hide",!1),l.value=a,n&&alert(n),window.location.reload()}))}}function vdnSynthesizeProcPopup(e,t){if(void 0!==e&&"show"!=e&&"hide"!=e)return;let n=document.getElementById("vdnLoaderModal");try{if(!n)return;let i="none",o="auto";if("show"==e){i="block",o="none";let e=document.getElementById("vdnTotalSynthResponseSection");if(e){let n=void 0!==t&&!0===t;e.style.display=n?"block":"none"}}n.style.display=i,document.body.style.pointerEvents=o}catch(e){n&&(n.style.display="none"),document.body.style.pointerEvents="auto"}}function vdnUpdateSynthCounter(e,t){let n=document.getElementById("vdnTotalSynthResponseSection");try{if(n&&"block"==n.style.display){let i=n.querySelector("span[id=vdnCurrentDialog]"),o=n.querySelector("span[id=vdnTotalSynthesizableDialogs]");i&&o&&(o.innerText=e,i.innerText=t)}}catch(e){n&&(n.style.display="none")}}window.addEventListener("load",function(){let e=vdnGetSynthesizableIntents(!1);e&&e.length>0&&(vdnSynthesizeProcPopup("show",!0),vdnSynthesizeRecursively(e,null,e.length,null))}),document.body.addEventListener("load",function(){document.body.style.pointerEvents="auto"});